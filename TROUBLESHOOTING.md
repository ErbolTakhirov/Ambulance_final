# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å OSRM Timeout

## –ü—Ä–æ–±–ª–µ–º–∞
OSRM —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç—è—Ç—Å—è:
```
OSRM Connection Error: Read timed out
All OSRM servers failed
```

## ‚úÖ –ß—Ç–æ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –£–≤–µ–ª–∏—á–µ–Ω timeout
- **–ë—ã–ª–æ:** 20 —Å–µ–∫—É–Ω–¥
- **–°—Ç–∞–ª–æ:** 30 —Å–µ–∫—É–Ω–¥
- –§–∞–π–ª: `api/traffic_router.py`

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞
- **2 –ø–æ–ø—ã—Ç–∫–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- –ü–∞—É–∑–∞ 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–µ—Ä–≤–µ—Ä—É

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ OSRM —Å–µ—Ä–≤–µ—Ä—ã
```python
self.osrm_servers = [
    "http://router.project-osrm.org/route/v1/driving",
    "https://routing.openstreetmap.de/routed-car/route/v1/driving",
    "https://router.project-osrm.org/route/v1/driving",  # HTTPS –≤–µ—Ä—Å–∏—è
]
```

### 4. –£–ª—É—á—à–µ–Ω Fallback –º–µ—Ö–∞–Ω–∏–∑–º
- **–ë—ã–ª–æ:** –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
- **–°—Ç–∞–ª–æ:** –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ —Ä–µ–∞–ª—å–Ω—ã–º —É–ª–∏—Ü–∞–º
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–ª–∏–∂–∞–π—à–∏–µ —É–ª–∏—Ü—ã –∏–∑ OSM
- –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏

### 5. –î–æ–±–∞–≤–ª–µ–Ω GraphHopper (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ OSRM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –¢—Ä–µ–±—É–µ—Ç API –∫–ª—é—á (–±–µ—Å–ø–ª–∞—Ç–Ω–æ 500 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å)

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GraphHopper (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å: https://graphhopper.com/
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
3. –û—Ç–∫—Ä–æ–π—Ç–µ `api/graphhopper_router.py`
4. –ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
```python
self.api_key = "YOUR_API_KEY_HERE"
```
–Ω–∞:
```python
self.api_key = "–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_–∫–ª—é—á"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π OSRM —Å–µ—Ä–≤–µ—Ä (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

```bash
# –°–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç—É –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞
wget http://download.geofabrik.de/asia/kyrgyzstan-latest.osm.pbf

# –ó–∞–ø—É—Å—Ç–∏—Ç—å OSRM –≤ Docker
docker run -t -v "${PWD}:/data" osrm/osrm-backend osrm-extract -p /opt/car.lua /data/kyrgyzstan-latest.osm.pbf
docker run -t -v "${PWD}:/data" osrm/osrm-backend osrm-partition /data/kyrgyzstan-latest.osrm
docker run -t -v "${PWD}:/data" osrm/osrm-backend osrm-customize /data/kyrgyzstan-latest.osrm
docker run -t -i -p 5000:5000 -v "${PWD}:/data" osrm/osrm-backend osrm-routed --algorithm mld /data/kyrgyzstan-latest.osrm

# –û–±–Ω–æ–≤–∏—Ç—å traffic_router.py
self.osrm_servers = [
    "http://localhost:5000/route/v1/driving",  # –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
    "http://router.project-osrm.org/route/v1/driving",
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ
]
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π Fallback

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ —É–ª–∏—Ü–∞–º:
- –ù–∞—Ö–æ–¥–∏—Ç –±–ª–∏–∂–∞–π—à–∏–µ —É–ª–∏—Ü—ã –∫ —Ç–æ—á–∫–∞–º —Å—Ç–∞—Ä—Ç–∞/—Ñ–∏–Ω–∏—à–∞
- –°—Ç—Ä–æ–∏—Ç –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ —ç—Ç–∏ —É–ª–∏—Ü—ã
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è —Å —É—á–µ—Ç–æ–º —Ç—Ä–∞—Ñ–∏–∫–∞

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
1. –ü–æ–ø—ã—Ç–∫–∞ OSRM —Å–µ—Ä–≤–µ—Ä #1 (2 –ø–æ–ø—ã—Ç–∫–∏ –ø–æ 30 —Å–µ–∫)
   ‚Üì –ù–µ—É–¥–∞—á–∞
2. –ü–æ–ø—ã—Ç–∫–∞ OSRM —Å–µ—Ä–≤–µ—Ä #2 (2 –ø–æ–ø—ã—Ç–∫–∏ –ø–æ 30 —Å–µ–∫)
   ‚Üì –ù–µ—É–¥–∞—á–∞
3. –ü–æ–ø—ã—Ç–∫–∞ OSRM —Å–µ—Ä–≤–µ—Ä #3 (2 –ø–æ–ø—ã—Ç–∫–∏ –ø–æ 30 —Å–µ–∫)
   ‚Üì –ù–µ—É–¥–∞—á–∞
4. –ü–æ–ø—ã—Ç–∫–∞ GraphHopper (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω API –∫–ª—é—á)
   ‚Üì –ù–µ—É–¥–∞—á–∞
5. Fallback: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ —É–ª–∏—Ü–∞–º OSM
   ‚úÖ –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç:

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
python manage.py runserver
```

2. –û—Ç–∫—Ä—ã—Ç—å http://127.0.0.1:8000/

3. –í—ã–±—Ä–∞—Ç—å –±–æ–ª—å–Ω–∏—Ü—É –∏ –ø—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

4. –ù–∞–∂–∞—Ç—å "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç"

5. –°–º–æ—Ç—Ä–µ—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞ –ª–æ–≥–∏:
```
Requesting OSRM (attempt 1/2): http://...
Requesting OSRM (attempt 2/2): http://...
GraphHopper API key not configured, skipping
Using fallback street-based route
```

## üìù –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º OSRM:
- –¢–æ—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –ø–æ –¥–æ—Ä–æ–≥–∞–º
- ML –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
- –£—á–µ—Ç –ø—Ä–æ–±–æ–∫

### –ü—Ä–∏ GraphHopper:
- –¢–æ—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –ø–æ –¥–æ—Ä–æ–≥–∞–º
- ML –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
- –£—á–µ—Ç –ø—Ä–æ–±–æ–∫

### –ü—Ä–∏ Fallback:
- –ú–∞—Ä—à—Ä—É—Ç –ø–æ –±–ª–∏–∂–∞–π—à–∏–º —É–ª–∏—Ü–∞–º
- –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: "Routing service unavailable, showing street-based route"

## ‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ:

1. **Fallback —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –º–∞—Ä—à—Ä—É—Ç—ã —Å—Ç—Ä–æ—è—Ç—Å—è –ø–æ —É–ª–∏—Ü–∞–º
2. **–î–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞** - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ GraphHopper (5 –º–∏–Ω—É—Ç):
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: https://graphhopper.com/
   - –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á
   - –í—Å—Ç–∞–≤–∏—Ç—å –≤ `api/graphhopper_router.py`
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

## üéØ –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å **–æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–∞** –∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏:
- ‚ùå –í—Å–µ OSRM —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- ‚ùå GraphHopper –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Fallback –ø–æ—Å—Ç—Ä–æ–∏—Ç –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–ª–∏—Ü–∞–º

–î–ª—è **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏**:
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GraphHopper (5 –º–∏–Ω)
2. –ò–ª–∏ —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π OSRM (30 –º–∏–Ω)
